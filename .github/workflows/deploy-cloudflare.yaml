on: push
  
jobs:
    publish-site:
      runs-on: ubuntu-latest
      permissions:
        contents: read
        deployments: write
      name: Publish to Cloudflare Pages
      steps:
        - name: Checkout
          uses: actions/checkout@v3
  
        - uses: actions/setup-node@v3
          with:
            node-version: "16"
        - run: npm i
        - run: npm run build
  
        - name: Upload
          env:
            PROJECT_NAME: antonfranz
            CLOUDFLARE_ACCOUNT_ID: 19a458e52412e37b50b512ae9de06ade
            CLOUDFLARE_API_TOKEN: ${{ secrets.CLOUDFLARE_API_TOKEN }}
          run: npx wrangler@3.1.1 pages deploy ".svelte-kit/cloudflare" --project-name="${{env.PROJECT_NAME}}" --branch="${{env.GITHUB_REF_NAME}}"